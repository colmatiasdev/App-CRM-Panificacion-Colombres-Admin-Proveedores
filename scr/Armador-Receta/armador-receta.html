<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Armador de Receta - Panificación Colombres</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../costos/costos.css">
    <script src="../Arquitectura/config.js"></script>
    <script src="../Arquitectura/config-sheets.js"></script>
    <script src="armador-receta-hub.config.js"></script>
</head>
<body class="costos-page">
    <nav class="costos-nav" aria-label="Navegación principal" id="armador-receta-nav">
        <a href="../../index.html" class="costos-nav-link">Inicio</a>
        <a href="armador-receta.html" class="costos-nav-link is-active">Armador de Receta</a>
    </nav>
    <main class="costos-main">
        <h1 class="costos-title">Armador de Receta</h1>
        <p class="costos-intro">Módulo para armar y configurar recetas (receta base, producto unitario base y elaboración productos base).</p>
        <div class="costos-datos" id="armador-receta-hub">
            <p class="costos-placeholder">Elegí una opción del módulo Armador de Receta.</p>
        </div>
    </main>
    <script>
        (function () {
            var config = window.ARMADOR_RECETA_HUB_CONFIG;
            if (!config || !config.modulos) return;

            var params = {};
            try {
                (window.location.search || "").replace(/^\?/, "").split("&").forEach(function (p) {
                    var parts = p.split("=");
                    if (parts[0]) params[parts[0]] = parts.length > 1 ? decodeURIComponent(parts[1].replace(/\+/g, " ")) : "";
                });
            } catch (e) {}
            var referrer = (typeof document.referrer === "string" ? document.referrer : "").toLowerCase();
            var ocultarRecetaDetallePorOrigen = (params.ocultarRecetaDetalle === "1" || params.desde === "receta-base") ||
                (referrer.indexOf("receta-base") !== -1 || referrer.indexOf("ver-receta-base") !== -1);

            function referrerOcultaModulo(mod) {
                if (!mod.ocultarSiReferrerContiene || !mod.ocultarSiReferrerContiene.length) return false;
                if (mod.id === "receta-detalle" && ocultarRecetaDetallePorOrigen) return true;
                return mod.ocultarSiReferrerContiene.some(function (s) { return referrer.indexOf(s) !== -1; });
            }

            var nav = document.getElementById("armador-receta-nav");
            if (nav && config.menuOpciones && config.menuOpciones.length) {
                config.menuOpciones.forEach(function (opcion) {
                    if (!opcion.visible) return;
                    var a = document.createElement("a");
                    a.href = opcion.href;
                    a.className = "costos-nav-link";
                    a.textContent = opcion.label || "";
                    nav.appendChild(a);
                });
            }

            var hub = document.getElementById("armador-receta-hub");
            if (!hub) return;
            var btnStyle = "display: inline-flex; align-items: center; gap: 8px;";

            config.modulos.forEach(function (mod) {
                if (!mod.visible || referrerOcultaModulo(mod)) return;

                var section = document.createElement("section");
                section.className = "costos-hub-modulo";
                section.setAttribute("aria-label", mod.label);
                if (mod.id) section.id = "hub-modulo-" + mod.id;

                var h2 = document.createElement("h2");
                h2.className = "costos-hub-modulo-titulo";
                var iconClass = mod.icono ? "fa-solid " + (mod.icono.indexOf("fa-") === 0 ? mod.icono : "fa-" + mod.icono) : "fa-solid fa-folder";
                h2.innerHTML = "<i class=\"" + iconClass + "\" aria-hidden=\"true\"></i> " + (mod.label || "");
                section.appendChild(h2);

                var btns = [];
                if (mod.botones && mod.botones.listar && mod.botones.listar.visible && mod.rutaListar) {
                    btns.push({ href: mod.rutaListar, icono: "fa-list", texto: mod.botones.listar.texto || "Listar" });
                }
                if (mod.botones && mod.botones.nuevo && mod.botones.nuevo.visible && mod.rutaNuevo) {
                    btns.push({ href: mod.rutaNuevo, icono: "fa-plus", texto: mod.botones.nuevo.texto || "Nuevo" });
                }

                if (btns.length) {
                    var divBtns = document.createElement("div");
                    divBtns.className = "costos-hub-btns";
                    btns.forEach(function (b) {
                        var link = document.createElement("a");
                        link.href = b.href;
                        link.className = "costos-calc-btn";
                        link.setAttribute("style", btnStyle);
                        link.innerHTML = "<i class=\"fa-solid " + b.icono + "\" aria-hidden=\"true\"></i> " + (b.texto || "");
                        divBtns.appendChild(link);
                    });
                    section.appendChild(divBtns);
                }
                hub.appendChild(section);
            });
        })();
    </script>
</body>
</html>
