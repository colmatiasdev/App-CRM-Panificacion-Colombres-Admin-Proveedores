<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Ver Receta Detalle - Panificación Colombres</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../../costos/costos.css">
    <script src="../../Arquitectura/config.js"></script>
    <script src="../../Arquitectura/config-sheets.js"></script>
    <script src="../../Arquitectura/sheets/receta-detalle/receta-detalle-sheets-base.js"></script>
    <script src="../../Arquitectura/sheets/receta-detalle/sheets-ver-receta-detalle.config.js"></script>
    <script src="../armador-receta-hub.config.js"></script>
    <script>window.RECETA_DETALLE_ACCION_ACTUAL = "ver"; window.ARMADOR_RECETA_SUBMODULO_ACTUAL = "receta-detalle";</script>
</head>
<body class="costos-page">
    <nav class="costos-nav" id="armador-receta-nav" aria-label="Navegación principal"></nav>
    <main class="costos-main">
        <h1 class="costos-title costos-title--con-icono"><i class="fa-solid fa-eye costos-title-icono" aria-hidden="true"></i> Ver Receta Detalle</h1>
        <p class="costos-intro">Datos del registro. Solo visualización.</p>
        <div id="ver-container" class="costos-datos">
            <p id="ver-no-data" class="costos-placeholder" style="display:none;">No hay datos del registro. Volvé al listado y usá «Ver».</p>
            <p id="ver-loading" class="costos-placeholder">Cargando…</p>
            <div id="ver-detalle" class="costos-ver-detalle" style="display:none;"></div>
            <div id="ver-actions" class="costos-edit-actions" style="display:none;">
                <a href="receta-detalle.html" class="costos-edit-btn-cancel">Volver al listado</a>
                <a href="editar-receta-detalle.html" class="costos-edit-btn-save"><i class="fa-solid fa-pen" aria-hidden="true"></i> Editar</a>
            </div>
        </div>
    </main>
    <script src="../armador-receta-nav.js"></script>
    <script src="../../Arquitectura/sheets/receta-detalle/receta-detalle-config.js"></script>
    <script>
        (function () {
            var STORAGE_EDIT = "costosEditRecordRecetaDetalle";
            function norm(s) { return String(s != null ? s : "").trim().toLowerCase().replace(/\s+/g, "").replace(/-/g, ""); }
            function mapRowToConfigOrder(rowFromStorage, headersFromStorage, columnas) {
                var configNombres = columnas.map(function (c) { return c.nombre; });
                var out = [];
                for (var i = 0; i < configNombres.length; i++) {
                    var nombre = configNombres[i];
                    var idx = -1;
                    for (var j = 0; j < headersFromStorage.length; j++) { if (norm(headersFromStorage[j]) === norm(nombre)) { idx = j; break; } }
                    out.push(idx >= 0 ? (rowFromStorage[idx] != null ? String(rowFromStorage[idx]) : "") : "");
                }
                return out;
            }
            function escapeHtml(text) { if (text == null) return ""; return String(text).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;"); }
            var noDataEl = document.getElementById("ver-no-data"); var loadingEl = document.getElementById("ver-loading"); var detalleEl = document.getElementById("ver-detalle"); var actionsEl = document.getElementById("ver-actions");
            var raw = sessionStorage.getItem(STORAGE_EDIT);
            if (!raw) { loadingEl.style.display = "none"; noDataEl.style.display = "block"; } else {
                var loadConfig = window.RECETA_DETALLE_LOAD_CONFIG;
                if (!loadConfig) { loadingEl.style.display = "none"; noDataEl.style.display = "block"; noDataEl.textContent = "No se pudo cargar la configuración."; } else {
                    loadConfig().then(function (sheetConfig) {
                        var data; try { data = JSON.parse(raw); } catch (e) { data = {}; }
                        var headersFromStorage = data.headers || []; var rowFromStorage = data.row || [];
                        var columnas = sheetConfig.columnas || []; var row = mapRowToConfigOrder(rowFromStorage, headersFromStorage, columnas);
                        loadingEl.style.display = "none"; detalleEl.style.display = "block"; actionsEl.style.display = "block";
                        function columnaVisible(col) { if (col == null) return false; if (col.visible === false || col.visible === "false") return false; return true; }
                        var html = "<dl class=\"costos-ver-dl\">";
                        columnas.forEach(function (col, idx) {
                            if (!columnaVisible(col)) return;
                            var nombre = (col.alias != null ? col.alias : col.nombre || "").trim();
                            if (!nombre) return;
                            var val = (row[idx] != null && row[idx] !== "") ? String(row[idx]).trim() : "—";
                            if ((col.tipoDato === "numeric" || col.tipo === "numeric") && col.formatoVisual && typeof window.formatNumeroVisual === "function" && val !== "—") {
                                var num = parseFloat(String(val).replace(",", "."));
                                if (!isNaN(num)) val = window.formatNumeroVisual(num, col.formatoVisual, col.decimales != null ? col.decimales : 2);
                            }
                            html += "<dt class=\"costos-ver-dt\">" + escapeHtml(nombre) + "</dt><dd class=\"costos-ver-dd\">" + escapeHtml(val) + "</dd>";
                        });
                        html += "</dl>";
                        detalleEl.innerHTML = html;
                    }).catch(function (err) { loadingEl.style.display = "none"; noDataEl.style.display = "block"; noDataEl.textContent = "Error: " + (err.message || ""); });
                }
            }
        })();
    </script>
</body>
</html>
